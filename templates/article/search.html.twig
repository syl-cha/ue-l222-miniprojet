{% extends 'base.html.twig' %}

{% block title %}UE-L222 | Recherche{% endblock %}

{% block body %}
    <h1 class="my-4">Recherche d'articles</h1>

    {# form de recherche #}
    <form method="get" action="{{ path('article_search') }}" class="mb-4">
        <div class="input-group">
            <input 
                type="text" 
                name="query" 
                class="form-control" 
                placeholder="Rechercher un article..." 
                value="{{ query }}"
                autofocus
            >
            <button class="btn btn-primary" type="submit">
                Rechercher
            </button>
        </div>
    </form>

    {# message de résultat #}
    {% if query %}
        <div class="alert alert-info">
            Résultats pour : <strong>"{{ query }}"</strong> - {{ articles|length }} article(s) trouvé(s)
        </div>
    {% endif %}

    {# afficheage des résultats #}
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Category</th>
                <th>Author</th>
                <th>Content</th>
                <th class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for article in articles %}
            <tr>
                <td>{{ article.id }}</td>
                <td>{{ article.title }}</td>
                <td>
                    {% if article.Category is not null and article.Category.name is defined %}
                        {{ article.Category.name }}
                    {% endif %}
                </td>
                <td>
                    {% if article.author %}
                        {{ article.author.firstName }} {{ article.author.lastName | upper }}
                    {% endif %}
                </td>
                <td>{{ article.content|slice(0, 60) ~ '...' }}</td>
                <td class="text-end">
                    <a href="{{ path('article_show', {'id': article.id}) }}" class="btn btn-sm btn-info">Show</a>
                    <a href="{{ path('article_edit', {'id': article.id}) }}" class="btn btn-sm btn-warning">Edit</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6" class="text-center">
                    {% if query %}
                        Aucun article trouvé pour "{{ query }}"
                    {% else %}
                        no records found
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-between">
        <a href="{{ path('article_new') }}" class="btn btn-primary">Create new</a>
        <a href="{{ path('article_index') }}" class="btn btn-secondary">Retour à la liste complète</a>
    </div>
{% endblock %}

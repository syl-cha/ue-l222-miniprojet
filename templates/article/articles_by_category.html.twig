{% extends 'base.html.twig' %}

{% block title %}Articles - {{ category.name }}{% endblock %}

{% block body %}
<div class="container py-5">
    <h1 class="my-4">Articles dans "{{ category.name }}"</h1>

    {% if articles|length > 0 %}
        <div class="row g-4">
            {% for article in articles %}
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm">
                        {% if article.image %}
                            {# On vérifie si c'est une URL (http...) ou un fichier local #}
                            {% if 'http' in article.image %}
                                <img src="{{ article.image }}" class="img-fluid rounded" alt="{{ article.title }}" style="width: 100%; height: 300px; object-fit: cover; object-position: center; border-radius: 8px;">
                            {% else %}
                                <img src="{{ asset('uploads/articles/' ~ article.image) }}" class="img-fluid rounded" alt="{{ article.title }}" style="width: 100%; height: 300px; object-fit: cover; object-position: center; border-radius: 8px;">
                            {% endif %}
                        {% else %}
                            <img src="{{ asset('images/default.jpg') }}" class="img-fluid rounded" alt="Image par défaut" style="width: 100%; height: 300px; object-fit: cover; object-position: center; border-radius: 8px;">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ article.title }}</h5>
                            <p class="text-muted"><i class="bi bi-calendar3"> </i>{{ article.createdAt|date('d/m/Y') }} |  <i class="bi bi-eye-fill"></i> {{ article.vueCount | default(0) }}
                                    {% if article.author %}
                                    <span class="ms-3">par {{ article.author.firstName }} {{ article.author.lastName | upper }}</span>
                                {% endif %}
                            </p>
                            <a href="{{ path('article_show', {'id': article.id}) }}" 
                               class="btn btn-primary mt-auto">Voir l'article</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center">Pas d'articles dans cette catégorie.</p>
    {% endif %}

    {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('category_edit', {'id': category.id}) }}" class="btn btn-warning mt-4"> <i class="bi bi-pencil"></i> 
            Modifier cette catégorie
        </a>
    {% endif %}
    <a href="{{ path('category_index') }}" class="btn btn-secondary mt-4"> <i class="bi bi-arrow-left"></i> Retour aux catégories</a>
</div>
{% endblock %}